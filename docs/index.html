---

title: pico_pi_controller


keywords: fastai
sidebar: home_sidebar

summary: "A service interface for one or more Raspberry Pi\* SBCs to be monitored & controlled by a Raspberry Pi Pico<sup>†</sup>, *using i2c*."
description: "A service interface for one or more Raspberry Pi\* SBCs to be monitored & controlled by a Raspberry Pi Pico<sup>†</sup>, *using i2c*."
nb_path: "index.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: index.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Requirements">Requirements<a class="anchor-link" href="#Requirements"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><em>Work in progress.</em> <em>See Hardware &amp; <a href="#Hardware-&amp;-Software-Instructions">Software Instructions below</a>.</em></p>
<ol>
<li>The RPi* must have GPIO pins 18 &amp; 19 free for use by <code>pigpio</code> as SDA &amp; SCL of secondary i2c controller.</li>
<li>RPi4 must have manual installaltion of <code>pigpio</code> for compatible i2c use.</li>
<li>Pico<sup>†</sup> must be running CircuitPython-6.x.</li>
<li>Pico<sup>†</sup> must have <code>adafruit_bus_device</code> &amp; <code>pico_pi_controller</code> CircuitPython libraries installed.</li>
</ol>
<p>* RPi 4/3/Zero, RPi4: GPIO pins 10 &amp; 11; <code>pigpio</code> enables use of the Broadcom SoC secondary i2c controller as a 'peripheral' device.</p>
<p><sup>†</sup> or any CircuitPython-capable MCU.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Install">Install<a class="anchor-link" href="#Install"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><code>pip install pico_pi_controller</code></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Hardware-&amp;-Software-Instructions">Hardware &amp; Software Instructions<a class="anchor-link" href="#Hardware-&amp;-Software-Instructions"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Quick-Start">Quick Start<a class="anchor-link" href="#Quick-Start"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><em>If using the simple setup of one RPi controlled by a Pico. Additinal RPi may be added by repeating steps 1 &amp; 4.</em></p>
<ol>
<li><p>Connect RPi secondary i2c pins to Pico primary i2c pins <strong>SDA↔SDA  SCL↔SCL  GND↔GND</strong>:</p>
<ol>
<li>On RPi*, connect <a href="https://pinout.xyz/">GPIO pins</a> 18 (SDA), 19 (SCL) and GND (any GND pin), e.g. using <a href="https://www.adafruit.com/product/1951">Female/Female Jumper Wires</a>; color conventions may be found <a href="https://learn.adafruit.com/introducing-adafruit-stemma-qt/technical-specs">here</a>.</li>
<li>On Pico†, connect wires from RPi (above) to the primary i2c bus, <a href="https://learn.adafruit.com/getting-started-with-raspberry-pi-pico-circuitpython/pinouts">board pins</a> 4 (SDA), 5 (SCL), and GND (any GND pin).</li>
</ol>
</li>
<li><p>Plug Pico into RPi USB port, e.g. using <a href="https://www.adafruit.com/product/898">MicroB to USB A cable</a>.</p>
</li>
<li><p>From RPi, install CircuitPython &amp; CircuitPython Library Bundle onto the Pico:</p>
<ol>
<li>On RPi, download <a href="https://circuitpython.org/downloads">CircuitPython</a> &amp; <a href="https://learn.adafruit.com/welcome-to-circuitpython/installing-circuitpython">install it</a> on your Pico.</li>
<li>On RPi, download &amp; unzip <a href="https://circuitpython.org/libraries">CircuitPython Library Bundle</a>, then copy from the <code>lib</code> folder <code>adafruit_bus_device</code> to the <code>lib</code> folder on your Pico (CIRCUITPY drive).</li>
</ol>
</li>
<li><p>On RPi, install <code>pico_pi_controller</code> components.</p>
<ol>
<li>On RPi, install <code>pico_pi_controller</code> (e.g. <code>pip3 install pico_pi_controller</code>)</li>
<li>On RPi, locate‡ &amp; copy <code>ppc-daemon.py</code> to the location of your choice and configure your system(s) to run the script on startup (it's a daemon), then reboot or manually run the daemon.</li>
</ol>
</li>
<li>From RPi, install <code>pico_pi_controller</code> for CircuitPython onto the Pico.<ol>
<li>On RPi, download &amp; unzip <code>pico_pi_controller</code> for CircuitPython, then copy from the <code>lib</code> folder <code>pico_pi_controller</code> to the <code>lib</code> folder on your Pico (CIRCUITPY drive).</li>
</ol>
</li>
<li>Unplug the Pico from the RPi USB port and connect it to a reguar USB power source.</li>
</ol>
<p>* RPi4 uses GPIO pins 10 (SDA), 11 (SCL).</p>
<p>† Other MCU boards will have different pinouts. If using an MCU board with a Qwiic or STEMMA QT connector, e.g. <a href="https://www.adafruit.com/product/4884">Adafruit Feather RP2040</a>, <a href="https://www.adafruit.com/product/4397">this cable</a> is useful.</p>
<p>‡ locate the installed files, e.g. in <code>~/.local/lib/python3.7/site-packages/pico_pi_controller/examples</code>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="How-to-use">How to use<a class="anchor-link" href="#How-to-use"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>On each RPi, with <code>pigpiod</code> running, run this example <code>ppc-daemon.py</code> script:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pico_pi_controller</span>

<span class="n">mydevice</span> <span class="o">=</span> <span class="n">pico_pi_controller</span><span class="o">.</span><span class="n">PPPeripheral</span><span class="p">(</span><span class="mh">0x13</span><span class="p">)</span>
</pre></div>
<p>Where <code>0x13</code> is the chosen <em>unique</em> I2C address of your RPi on the I2C bus where an MCU controller is running (e.g. a Pico running <code>CircuitPython_pico_pi_controller</code>.</p>
<p>A more sophisticated example:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pico_pi_controller</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">import</span> <span class="nn">logging</span>

<span class="n">address</span><span class="o">=</span><span class="mh">0x13</span>

<span class="k">def</span> <span class="nf">i2c_peripheral</span><span class="p">(</span><span class="n">address</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">mydevice</span>
    <span class="n">mydevice</span> <span class="o">=</span> <span class="n">pico_pi_controller</span><span class="o">.</span><span class="n">PPPeripheral</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;PPC: starting I2C peripheral &quot;</span><span class="p">,</span><span class="nb">hex</span><span class="p">(</span><span class="n">address</span><span class="p">))</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">i2c_peripheral</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">bosmang</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">UART_TX</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">UART_RX</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">PWR</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">PEN</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">threads</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="n">t</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;PPC: last controller contact&quot;</span><span class="p">,</span><span class="n">mydevice</span><span class="o">.</span><span class="n">last_contact</span><span class="p">(),</span><span class="s2">&quot;seconds ago.&quot;</span><span class="p">)</span>
    <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
<p>When your device declares itself to be <em>bosmang</em>, it sends its own datetime for setting the controller's RTC. Optionally, a <em>bosmang</em> can send commands to the controller, e.g. to reboot or shutdown any connected RPi. Additionally, <em>bosmang</em> may have its console UART, gpio-poweroff, and PEN pins connected to GPIO pins on the controller which enables the controller to execute a safe shutdown &amp; poweroff plus full poweronn of <em>bosmang</em>.</p>

</div>
</div>
</div>
</div>
 

